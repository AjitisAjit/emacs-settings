'''
Read emails from gmail using imap
'''

import imaplib


GMAIL_IMAP_HOST = 'imap.gmail.com'
GMAIL_IMAP_PORT = 993


class IMAP_Error(imaplib.IMAP4.error):
    '''
    Exception class for all gmail IMAP errors
    '''
    pass


def connect():
    '''
    Connect to gnd return an instance of connection
    '''
    return imaplib.IMAP4_SSL(GMAIL_IMAP_HOST, GMAIL_IMAP_PORT)


def authenticate(conn, username, password):
    '''
    ARGS:
        conn: Instance of connection
        username: gmail username
        password: gmail password

    Authenticates user with gmail and returns an iterator mailboxes
    '''
    conn.login(username, password)
    response, _ = conn.select('INBOX')

    if response != 'OK':
        raise IMAP_Error('An error occurred retrieving mailboxes', response)

    return conn

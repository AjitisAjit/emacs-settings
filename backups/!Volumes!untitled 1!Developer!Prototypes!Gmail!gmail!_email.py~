'''
Provides functionality for parsing emails
'''

import datetime


class Email:
    '''
    Email class representing an email
    '''
    def __new__(self, email_message):
        self.subject = email_message['Subject']
        self.sender = email_message['From']
        self.timestamp = _parse_email_date(email_message['Date'])
        self.body = _parse_email_body(email_message)

    @property
    def sender(self):
        return self.sender

    @property
    def timestamp(self):
        return self.timestamp

    @property
    def body(self):
        return self.body


def _parse_email_body(email):
    maintype = email.get_content_maintype()
    content = []

    if maintype == 'multipart':
        for part in email.get_payload():
            if part.get_content_maintype() == 'text':
                content.append(part.get_payload())
    elif maintype == 'text':
        content.append(email.get_payload())

    return content


def _parse_email_date(email_date):
    datetime_str = email_date.split(',')[1].split('-')[0].strip()
    datetime_obj = datetime.datetime.strptime(datetime_str, '%d %b %Y %H:%M:%S')
    return datetime_obj
